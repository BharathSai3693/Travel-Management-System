<!DOCTYPE html>
<html lang="en">
  <%- include("./partials/head.ejs") %> <%- include("./partials/header.ejs") %>

  <body class="tms-page">
    <section class="tms-page-header">
      <div class="container">
        <div class="d-flex flex-wrap align-items-center justify-content-between">
          <div>
            <p class="tms-pill d-inline-block mb-2">Secure booking</p>
            <h1 class="mb-1">Book Your Trip</h1>
            <p class="text-muted mb-0">
              Review the package and confirm your booking details.
            </p>
          </div>
          <a class="btn tms-btn-outline mt-3 mt-lg-0" href="/userpackages/<%= p._id %>">
            Back to package
          </a>
        </div>
      </div>
    </section>

    <section class="tms-section">
      <div class="container">
        <div class="row">
          <div class="col-lg-6 mb-4">
            <div class="tms-package-card">
              <div class="tms-package-media">
                <img src="<%= p.packageImage %>" alt="<%= p.packageName %>" />
              </div>
              <div class="tms-package-body">
                <h4 class="mb-2"><%= p.packageName %></h4>
                <p class="text-muted mb-3">
                  <%= p.packageType %> • <%= p.packageLocation %>
                </p>
                <div class="tms-package-meta">
                  <span><strong>Price:</strong> ₹<%= p.packagePrice %></span>
                  <span><strong>Days:</strong> <%= p.days %></span>
                  <span
                    ><strong>Start Date:</strong>
                    <%= p.startDate.toUTCString().substring(0,16) %></span
                  >
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-6 mb-4">
            <div class="tms-card">
              <h4 class="mb-3">Traveler details</h4>
              <form
                name="detailsForm"
                action="/booking/<%=p._id%>"
                method="post"
                id="bookpackage"
                onsubmit="return Validate()"
              >
                <div class="form-group">
                  <label>Email address</label>
                  <input
                    type="email"
                    name="bookingMail"
                    class="form-control"
                    value="<%= user ? user.email : '' %>"
                    required
                  />
                </div>
                <div class="form-group">
                  <label>Mobile Number</label>
                  <input
                    type="tel"
                    name="bookingMobile"
                    class="form-control"
                    value="<%= user ? user.mobile : '' %>"
                    required
                  />
                </div>
                <div class="form-group">
                  <label>Special Remarks</label>
                  <input
                    type="text"
                    name="bookingRemarks"
                    class="form-control"
                    required
                  />
                </div>

                <div class="form-group">
                  <label>Number of Passengers</label>
                  <input
                    type="number"
                    name="passengers"
                    class="form-control"
                    required
                  />
                </div>
                <button
                  type="button"
                  class="btn tms-btn w-100"
                  data-toggle="modal"
                  data-target="#exampleModal"
                >
                  Book Package
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>
  </body>

  <!-- modal -->
  <div
    class="modal fade tms-modal"
    id="exampleModal"
    tabindex="-1"
    role="dialog"
    aria-labelledby="exampleModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Confirmation</h5>
          <button
            type="button"
            class="close"
            data-dismiss="modal"
            aria-label="Close"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">Are you sure want to book this package?</div>
        <div class="modal-footer">
          <button type="button" class="btn tms-btn-outline" data-dismiss="modal">
            Close
          </button>

          <button type="button" onclick="bookpackage()" class="btn tms-btn">
            Book Package
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- validation modals -->
  <div class="modal fade tms-modal" id="mobileError" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content bg-danger">
        <div class="modal-header">
          <h5 class="modal-title text-white" id="exampleModalLabel">
            Phone number should start with 6,7,8,9 and of length 10
          </h5>
          <button
            type="button"
            class="close"
            data-dismiss="modal"
            aria-label="Close"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade tms-modal" id="emailError" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content bg-danger">
        <div class="modal-header">
          <h5 class="modal-title text-white" id="exampleModalLabel">
            Enter Valid Email
          </h5>
          <button
            type="button"
            class="close"
            data-dismiss="modal"
            aria-label="Close"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    function bookpackage() {
      let x = document.forms["detailsForm"]["bookingMail"].value;
      let y = document.forms["detailsForm"]["bookingMobile"].value;
      let z = document.forms["detailsForm"]["bookingRemarks"].value;

      var emailRegex = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
      var mobileRegex = /^[6789]\d{9}$/;
      if (x == "" || y == "" || z == "") {
        alert("Fill all the Details");
      } else if (!emailRegex.test(x)) {
        $("#emailError").modal();
      } else if (!mobileRegex.test(y)) {
        $("#mobileError").modal();
      } else {
        document.getElementById("bookpackage").submit();
      }
    }

    function Validate() {
      return false;
    }
  </script>
</html>
