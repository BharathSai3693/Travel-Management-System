<!DOCTYPE html>
<html lang="en">
  <%- include('./partials/head.ejs') %>
  <% if(user_id){ %>
  <%- include('./partials/header.ejs') %>
  <% } else { %>
  <%- include('./partials/headersignout.ejs') %>
  <% } %>

  <body class="tms-page">
    <section class="tms-page-header">
      <div class="container">
        <div class="d-flex flex-wrap align-items-center justify-content-between">
          <div>
            <p class="tms-pill d-inline-block mb-2">Curated journeys</p>
            <h1 class="mb-1">Packages</h1>
            <p class="text-muted mb-0">
              Explore handpicked trips designed for every kind of traveler.
            </p>
          </div>
          <button
            type="button"
            class="btn tms-btn mt-3 mt-lg-0"
            data-toggle="modal"
            data-target="#exampleModal"
          >
            Set preferences
          </button>
        </div>
      </div>
    </section>

    <!--  if(messages.length != 0){ %>
    <div class="alert alert-success" role="alert">
      <h4 class="alert-heading">< messages </h4>
    </div>
     -->

    <section class="tms-section">
      <div class="container">
        <div class="row">
          <%for( let p of packages){ %>
          <div class="col-lg-6 mb-4">
            <div class="tms-package-card">
              <div class="tms-package-media">
                <img src="<%=p.packageImage%>" alt="<%= p.packageName %>" />
              </div>
              <div class="tms-package-body">
                <div class="d-flex align-items-start justify-content-between">
                  <div>
                    <h4 class="mb-1"><%= p.packageName%></h4>
                    <p class="text-muted mb-2">
                      <%= p.packageLocation %> • <%= p.packageType %>
                    </p>
                  </div>
                  <div class="tms-price">
                    ₹<%= p.packagePrice %>
                    <span class="tms-price-note">per person</span>
                  </div>
                </div>

                <div class="tms-package-meta">
                  <span><strong>Days:</strong> <%= p.days %></span>
                  <span
                    ><strong>Date:</strong>
                    <%= p.startDate.toISOString().substring(0, 10); %></span
                  >
                </div>

                <div class="tms-chip-row">
                  <% for(let f of p.packageFeatures){ %>
                  <span class="tms-chip"><%= f %></span>
                  <% } %>
                </div>

                <form action="/userpackages/<%=p._id%>" method="get">
                  <button class="btn tms-btn">Open Package</button>
                </form>
              </div>
            </div>
          </div>
          <% } %>
        </div>
      </div>
    </section>
  </body>

  <%- include('partials/preferences.ejs') %>
  <script>
    var tags = "<%= tags%>";
    tags = tags.split(",");
    const docs = document.getElementsByClassName("form-check-input");
    for (let d of docs) {
      if (tags.includes(d.value)) {
        d.checked = true;
      }
    }

    var left = document.getElementsByClassName("picture");
    var right = document.getElementsByClassName("rightcol");
    var width = document.getElementsByClassName("leftcol");
    for (var i = 0; i < left.length; i++) {
      console.log(width[i]);
      left[i].style.height = `${right[i].offsetHeight - 25}px`;
      left[i].style.width = `${width[i].offsetWidth - 25}px`;
    }
  </script>
</html>
